<div class="card transfer">
  <p-progressBar
    *ngIf="submitting"
    class="transfer__progress"
    mode="indeterminate"
    [style]="{ height: '4px' }"
  ></p-progressBar>
  <form [formGroup]="importForm" (ngSubmit)="onImportSubmit()">
    <div class="p-fluid">
      <h5>Імпорт продуктів</h5>
      <div class="field">
        <label for="import-source">Джерело імпорту:</label>
        <p-dropdown
          id="import-source"
          [options]="importSources"
          formControlName="source"
          optionValue="value"
        ></p-dropdown>
        <app-form-control-error-message
          [formGroup]="importForm"
          controlName="source"
          errorType="required"
          errorMessage="Необхідно обрати джерело імпорту"
        ></app-form-control-error-message>
      </div>
      <div class="field">
        <p-selectButton
          formControlName="sourceType"
          [options]="importSourceTypes"
        ></p-selectButton>
      </div>
      <div
        *ngIf="sourceType?.value === importSourceTypeEnum.Link"
        class="field"
      >
        <label for="link">Посилання:</label>
        <input id="link" pInputText formControlName="link" />
        <app-form-control-error-message
          [formGroup]="importForm"
          controlName="link"
          errorType="required"
          errorMessage="Необхідно ввести посилання"
        ></app-form-control-error-message>
      </div>
    </div>
    <div
      *ngIf="sourceType?.value === importSourceTypeEnum.File"
      class="formgrid"
    >
      <div class="field">
        <label>Файл (XML/XLS):</label>
        <p-fileUpload
          accept=".xml, .xls, .xlsx"
          [customUpload]="true"
          [auto]="true"
          [maxFileSize]="10000000"
          [disabled]="file!.disabled"
          (uploadHandler)="onFileUpload($event)"
        >
        </p-fileUpload>
        <app-form-control-error-message
          [formGroup]="importForm"
          controlName="file"
          errorType="required"
          errorMessage="Необхідно вибрати файл"
        ></app-form-control-error-message>
      </div>
    </div>
    <button
      pButton
      type="submit"
      label="Імпортувати"
      [disabled]="submitting"
    ></button>
  </form>
</div>

<div *ngIf="importResults$ | async as importResults" class="card">
  <h5>Результати імпорту</h5>

  <h6><b>Створено:</b></h6>
  <div>Базових товарів: {{ importResults.created.productBases.length }}</div>
  <div>Товарів: {{ importResults.created.productVariants.length }}</div>
  <div>Категорій: {{ importResults.created.productCategories.length }}</div>
  <div>Фотографій: {{ importResults.created.productImages.length }}</div>
  <div>Кольорів: {{ importResults.created.productColors.length }}</div>
  <div>Розмірів: {{ importResults.created.productSizes.length }}</div>
  <div>Габаритів: {{ importResults.created.productPackageSizes.length }}</div>

  <h6><b>Оновлено:</b></h6>
  <div>Базових товарів: {{ importResults.updated.productBases.length }}</div>
  <div>Товарів: {{ importResults.updated.productVariants.length }}</div>

  <h6><b>Всього:</b></h6>
  <div>
    Базових товарів:
    {{
      importResults.created.productBases.length +
        importResults.updated.productBases.length
    }}
  </div>
  <div>
    Товарів:
    {{
      importResults.created.productVariants.length +
        importResults.updated.productVariants.length
    }}
  </div>

  <h6><b>Помилки:</b></h6>
  <div>Всього: {{ importResults.errors.length }}</div>
  <p-panel
    header="Технічні деталі"
    [toggleable]="true"
    [collapsed]="true"
    expandIcon="pi pi-minus"
    collapseIcon="pi pi-plus"
  >
    <!-- <div class="rich-content" [innerHTML]="faq.answer | safeHtml"></div> -->
  </p-panel>
</div>
